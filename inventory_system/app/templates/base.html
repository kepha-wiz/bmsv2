<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}CKS Business Management System{% endblock %}</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <style>
        #sidebar {
            width: 250px;
            min-height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 100;
            transition: all 0.3s;
        }
        
        #sidebar.collapsed {
            width: 80px;
        }
        
        .sidebar-toggle {
            position: absolute;
            right: -15px;
            top: 20px;
            background: #343a40;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 101;
        }
        
        .main-content {
            margin-left: 250px;
            transition: all 0.3s;
            min-height: 100vh;
        }
        
        .main-content.expanded {
            margin-left: 80px;
        }
        
        @media (max-width: 768px) {
            #sidebar {
                display: none;
            }
            .main-content {
                margin-left: 0;
            }
        }
    </style>

    {% block styles %}{% endblock %}
</head>
<body class="d-flex">

    <!-- SIDEBAR -->
    <nav id="sidebar" class="bg-dark text-white p-3 d-none d-md-block">
        <div class="text-center mb-4">
            <button class="sidebar-toggle" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
            <h5 class="mt-3"><i class="fa fa-box"></i> CKS B.M.S</h5>
        </div>
        
        <ul class="nav flex-column">
            {% if current_user.is_authenticated %}
                {% if current_user.is_admin() %}
                    <!-- ADMIN LINKS -->
                    <li class="nav-item mb-2">
                        <a class="nav-link text-white {% if request.endpoint == 'admin.dashboard' %}active fw-bold{% endif %}" href="{{ url_for('admin.dashboard') }}">
                            <i class="fa fa-chart-line"></i> <span class="sidebar-text">Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link text-white {% if request.endpoint == 'admin.products' %}active fw-bold{% endif %}" href="{{ url_for('admin.products') }}">
                            <i class="fa fa-boxes"></i> <span class="sidebar-text">Products</span>
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link text-white {% if request.endpoint == 'admin.add_product' %}active fw-bold{% endif %}" href="{{ url_for('admin.add_product') }}">
                            <i class="fa fa-plus-circle"></i> <span class="sidebar-text">Add Product</span>
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link text-white {% if request.endpoint == 'admin.add_stock' %}active fw-bold{% endif %}" href="{{ url_for('admin.add_stock') }}">
                            <i class="fa fa-layer-group"></i> <span class="sidebar-text">Add Stock</span>
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link text-white {% if request.endpoint == 'admin.stock_movement' %}active fw-bold{% endif %}" href="{{ url_for('admin.stock_movement') }}">
                            <i class="fa fa-exchange-alt"></i> <span class="sidebar-text">Stock Movement</span>
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link text-white {% if request.endpoint == 'admin.sales' %}active fw-bold{% endif %}" href="{{ url_for('admin.sales') }}">
                            <i class="fa fa-shopping-cart"></i> <span class="sidebar-text">Sales</span>
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link text-white {% if request.endpoint == 'admin.reports' %}active fw-bold{% endif %}" href="{{ url_for('admin.reports') }}">
                            <i class="fa fa-file-alt"></i> <span class="sidebar-text">Reports</span>
                        </a>
                    </li>
                {% else %}
                    <!-- EMPLOYEE LINKS -->
                    <li class="nav-item mb-2">
                        <a class="nav-link text-white {% if request.endpoint == 'employee.dashboard' %}active fw-bold{% endif %}" href="{{ url_for('employee.dashboard') }}">
                            <i class="fa fa-chart-line"></i> <span class="sidebar-text">Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link text-white {% if request.endpoint == 'employee.products' %}active fw-bold{% endif %}" href="{{ url_for('employee.products') }}">
                            <i class="fa fa-boxes"></i> <span class="sidebar-text">Products</span>
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link text-white {% if request.endpoint == 'employee.add_sale' %}active fw-bold{% endif %}" href="{{ url_for('employee.add_sale') }}">
                            <i class="fa fa-plus-circle"></i> <span class="sidebar-text">Record Sale</span>
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link text-white {% if request.endpoint == 'employee.sales' %}active fw-bold{% endif %}" href="{{ url_for('employee.sales') }}">
                            <i class="fa fa-receipt"></i> <span class="sidebar-text">My Sales</span>
                        </a>
                    </li>
                {% endif %}
                <hr class="bg-light">
                <li>
                    <a class="nav-link text-danger" href="{{ url_for('auth.logout') }}">
                        <i class="fa fa-sign-out-alt"></i> <span class="sidebar-text">Logout</span>
                    </a>
                </li>
            {% endif %}
        </ul>
    </nav>

    <!-- MAIN CONTENT -->
    <div class="main-content flex-grow-1" id="mainContent">

        <!-- TOP NAVBAR -->
        <nav class="navbar navbar-light bg-light px-4 shadow-sm d-flex justify-content-between">
            <button class="btn btn-outline-dark d-md-none" data-bs-toggle="offcanvas" data-bs-target="#mobileMenu">
                <i class="fa fa-bars"></i>
            </button>

            <span class="navbar-text ms-auto">
                {% if current_user.is_authenticated %}
                    <b>CKS BUSINESS MANAGEMENT SYSTEM</b>
                    <div class="small">Logged in as: <strong>{{ current_user.username }}</strong></div>
                {% endif %}
            </span>
            <!-- Add this to the navbar section -->
<div class="container-fluid px-4">
    <div class="row">
        <div class="col-md-6">
            <form class="d-flex" method="GET" action="{{ url_for('admin.search_products') if current_user.is_admin() else url_for('employee.search_products') }}">
                <div class="input-group">
                    <input type="text" name="query" class="form-control" placeholder="Search products..." value="{{ request.args.get('query', '') }}">
                    <button class="btn btn-outline-secondary" type="submit">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </form>
        </div>
        <div class="col-md-6 text-end">
            {% if current_user.is_authenticated %}
                <span class="text-muted">Welcome, <strong>{{ current_user.username }}</strong></span>
            {% endif %}
        </div>
    </div>
</div>
        </nav>

        <!-- MOBILE MENU -->
        <div class="offcanvas offcanvas-start" tabindex="-1" id="mobileMenu">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title"><i class="fa fa-box"></i> Inventory Menu</h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
            </div>

            <div class="offcanvas-body">
                <ul class="nav flex-column">
                    {% if current_user.is_authenticated %}
                        {% if current_user.is_admin() %}
                            <li class="nav-item mb-2">
                                <a class="nav-link {% if request.endpoint == 'admin.dashboard' %}fw-bold text-primary{% endif %}" href="{{ url_for('admin.dashboard') }}">Dashboard</a>
                            </li>
                            <li class="nav-item mb-2">
                                <a class="nav-link {% if request.endpoint == 'admin.products' %}fw-bold text-primary{% endif %}" href="{{ url_for('admin.products') }}">Products</a>
                            </li>
                            <li class="nav-item mb-2">
                                <a class="nav-link {% if request.endpoint == 'admin.add_product' %}fw-bold text-primary{% endif %}" href="{{ url_for('admin.add_product') }}">Add Product</a>
                            </li>
                            <li class="nav-item mb-2">
                                <a class="nav-link {% if request.endpoint == 'admin.add_stock' %}fw-bold text-primary{% endif %}" href="{{ url_for('admin.add_stock') }}">Add Stock</a>
                            </li>
                            <li class="nav-item mb-2">
                                <a class="nav-link {% if request.endpoint == 'admin.stock_movement' %}fw-bold text-primary{% endif %}" href="{{ url_for('admin.stock_movement') }}">Stock Movement</a>
                            </li>
                            <li class="nav-item mb-2">
                                <a class="nav-link {% if request.endpoint == 'admin.sales' %}fw-bold text-primary{% endif %}" href="{{ url_for('admin.sales') }}">Sales</a>
                            </li>
                            <li class="nav-item mb-2">
                                <a class="nav-link {% if request.endpoint == 'admin.reports' %}fw-bold text-primary{% endif %}" href="{{ url_for('admin.reports') }}">Reports</a>
                            </li>
                        {% else %}
                            <li class="nav-item mb-2">
                                <a class="nav-link {% if request.endpoint == 'employee.dashboard' %}fw-bold text-primary{% endif %}" href="{{ url_for('employee.dashboard') }}">Dashboard</a>
                            </li>
                            <li class="nav-item mb-2">
                                <a class="nav-link {% if request.endpoint == 'employee.products' %}fw-bold text-primary{% endif %}" href="{{ url_for('employee.products') }}">Products</a>
                            </li>
                            <li class="nav-item mb-2">
                                <a class="nav-link {% if request.endpoint == 'employee.add_sale' %}fw-bold text-primary{% endif %}" href="{{ url_for('employee.add_sale') }}">Record Sale</a>
                            </li>
                            <li class="nav-item mb-2">
                                <a class="nav-link {% if request.endpoint == 'employee.sales' %}fw-bold text-primary{% endif %}" href="{{ url_for('employee.sales') }}">My Sales</a>
                            </li>
                        {% endif %}
                        <hr>
                        <li>
                            <a class="nav-link text-danger" href="{{ url_for('auth.logout') }}">Logout</a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>

        <!-- PAGE CONTENT -->
        <div class="container-fluid py-4">
            {% block content %}{% endblock %}
        </div>
    </div>

    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    
    <script>
        // Toggle sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const sidebarTexts = document.querySelectorAll('.sidebar-text');
            
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
            
            // Hide/show text when sidebar is collapsed
            sidebarTexts.forEach(text => {
                if (sidebar.classList.contains('collapsed')) {
                    text.style.display = 'none';
                } else {
                    text.style.display = 'inline';
                }
            });
        }
        
        // Initialize sidebar state
        document.addEventListener('DOMContentLoaded', function() {
            // Check if we should start with collapsed sidebar on mobile
            if (window.innerWidth < 768) {
                const sidebar = document.getElementById('sidebar');
                const mainContent = document.getElementById('mainContent');
                sidebar.classList.add('collapsed');
                mainContent.classList.add('expanded');
                
                // Hide sidebar text
                document.querySelectorAll('.sidebar-text').forEach(text => {
                    text.style.display = 'none';
                });
            }
        });
    </script>
    
    {% block scripts %}{% endblock %}
    <!-- FOOTER -->
<footer class="bg-dark text-white py-4 mt-auto">
    <div class="container">
        <!-- <div class="row">
            <div class="col-md-6 mb-4 mb-md-0">
                <h5 class="text-uppercase fw-bold">CKS Business Management System</h5>
                <p class="mb-2">A comprehensive inventory and sales management solution for businesses of all sizes.</p>
                
                <div class="d-flex gap-3 mb-3">
                    <a href="https://www.facebook.com" class="text-white" title="Facebook">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="https://www.twitter.com" class="text-white" title="Twitter">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://www.instagram.com" class="text-white" title="Instagram">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="https://www.linkedin.com" class="text-white" title="LinkedIn">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                </div>
                
                <div class="d-flex gap-3">
                    <a href="tel:+256755261254" class="text-white text-decoration-none">
                        <i class="fas fa-phone me-2"></i>+256 755 261 254
                    </a>
                    <a href="mailto:kephacheps55@gmail.com" class="text-white text-decoration-none">
                        <i class="fas fa-envelope me-2"></i>kephacheps55@gmail.com
                    </a>
                    <a href="https://wa.me/256755261254" class="text-white text-decoration-none" target="_blank">
                        <i class="fab fa-whatsapp me-2" style="color: #0bf837;"></i>+256 755 261 254
                    </a>
                </div>
            </div>
            
            <div class="col-md-3 mb-4 mb-md-0">
                <h5 class="text-uppercase fw-bold">Quick Links</h5>
                <ul class="list-unstyled">
                    <li class="mb-2">
                        <a href="{{ url_for('admin.dashboard') }}" class="text-white text-decoration-none">
                            <i class="fas fa-tachometer-alt me-2"></i>Admin Dashboard
                        </a>
                    </li>
                    <li class="mb-2">
                        <a href="{{ url_for('employee.dashboard') }}" class="text-white text-decoration-none">
                            <i class="fas fa-user me-2"></i>Employee Dashboard
                        </a>
                    </li>
                    <li class="mb-2">
                        <a href="#" class="text-white text-decoration-none" onclick="showHelpModal()">
                            <i class="fas fa-question-circle me-2"></i>Help & Support
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        
        <hr class="border-secondary"> -->
        
        <div class="row">
            <div class="col-md-12 text-center">
                <p class="mb-0">&copy; {{ current_year }} CKS-Tech. All Rights Reserved.<a href="tel:+256755261254" class="text-white text-decoration-none">
                        <i class="fas fa-phone me-2" style="color:rgb(110, 246, 221);"></i>call us     
                    </a>
                    <a href="mailto:kephacheps55@gmail.com" class="text-white text-decoration-none">
                        <i class="fas fa-envelope me-2" style="color: rgb(242, 98, 82);"></i>Email    
                    </a>
                    <a href="https://wa.me/256755261254" class="text-white text-decoration-none" target="_blank">
                        <nbsp> </nbsp><i class="fab fa-whatsapp me-2" style="color: #0bf837;"></i>Chat with us on whatsaap
                    </a></p>
                <p class="small text-muted">Designed and developed with <i class="fas fa-heart text-danger"></i> in Uganda</p>
            </div>
        </div>
    </div>
</footer>

<!-- Help Modal
<div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="helpModalLabel">
                    <i class="fas fa-question-circle me-2"></i>Help & Support
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="fas fa-book me-2"></i>User Guide</h6>
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <a href="#" class="text-decoration-none">
                                    <i class="fas fa-user me-2"></i>How to add products
                                </a>
                            </li>
                            <li class="mb-2">
                                <a href="#" class="text-decoration-none">
                                    <i class="fas fa-layer-group me-2"></i>How to manage stock
                                </a>
                            </li>
                            <li class="mb-2">
                                <a href="#" class="text-decoration-none">
                                    <i class="fas fa-shopping-cart me-2"></i>How to record sales
                                </a>
                            </li>
                            <li class="mb-2">
                                <a href="#" class="text-decoration-none">
                                    <i class="fas fa-file-alt me-2"></i>How to generate reports
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-headset me-2"></i>System Features</h6>
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <a href="#" class="text-decoration-none">
                                    <i class="fas fa-chart-line me-2"></i>Dashboard Analytics
                                </a>
                            </li>
                            <li class="mb-2">
                                <a href="#" class="text-decoration-none">
                                    <i class="fas fa-exchange-alt me-2"></i>Stock Movement Tracking
                                </a>
                            </li>
                            <li class="mb-2">
                                <a href="#" class="text-decoration-none">
                                    <i class="fas fa-dollar-sign me-2"></i>Price Management
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="window.open('mailto:kephacheps55@gmail.com?subject=CKS%20System%20Support')">
                    <i class="fas fa-envelope me-2"></i>Email Support
                </button>
            </div>
        </div>
    </div>
</div> -->
</body>
</html>